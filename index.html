<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="차원을 넘어선 교감, 멀티버스 크리처 랩: 신화의 충돌. 성인 타겟의 고퀄리티 수집형 RPG.">
    <title>Multiverse Creature Lab</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <!-- PortOne SDK (V2) -->
    <script src="https://cdn.portone.io/v2/browser-sdk.js"></script>
    <link rel="stylesheet" href="css/style_v4.css?v=v4_adsense">
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-5874227298630347"
        crossorigin="anonymous"></script>
</head>

<body>
    <div id="app-container">
        <!-- 로비 캐릭터는 layout-container 안에 통합됨 -->

        <!-- [NEW] 2. Floating Header -->
        <header id="game-header" class="glass-panel">
            <div id="user-info-area" style="display:flex; align-items:center; gap:15px;">
                <div style="font-weight:bold; color:var(--accent-primary); font-family:'Orbitron';">DIRECTOR</div>
                <div id="header-user-name">Guest</div>
                <div id="header-user-level"
                    style="background:rgba(255,255,255,0.1); padding:2px 8px; border-radius:4px; font-size:0.85em;">Lv.1
                </div>
            </div>

            <div class="resource-bar">
                <div class="res-item" title="Gold">
                    <span class="res-icon">💰</span>
                    <span id="gold-display" class="res-value" data-resource="gold">0</span>
                </div>
                <div class="res-item" title="Gems">
                    <span class="res-icon">💎</span>
                    <span id="gem-display" class="res-value" data-resource="gem">0</span>
                </div>
                <!-- Energy Removed for cleaner look or keep minimal -->
                <div class="res-item" title="Energy">
                    <span class="res-icon">⚡</span>
                    <span id="energy-display" class="res-value" data-resource="energy">100/100</span>
                </div>
            </div>
            <div style="display:flex; gap:10px; align-items:center;">
                <button id="btn-open-system" class="cyber-btn small" title="시스템">⚙️</button>
                <button id="btn-lang-toggle" class="cyber-btn small" title="언어 변경">🌐 KR</button>
            </div>
        </header>

        <!-- 3. Main Content Area -->
        <main id="main-area">


            <!-- AdSense 배너 광고 영역 -->
            <div id="ad-banner-top"
                style="width:100%; min-height:90px; background:rgba(0,0,0,0.3); display:flex; justify-content:center; align-items:center; margin-bottom:10px; border-radius:8px;">
                <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-5874227298630347"
                    data-ad-slot="auto" data-ad-format="auto" data-full-width-responsive="true"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>

            <!-- 2.2 Content Viewport -->
            <div id="content-viewport">


                <!-- PANELS -->


                <!-- 실제 컨텐츠 (화면별 전환) -->
                <!-- 기존의 3단 레이아웃은 '관리(Home)' 화면의 일부로 재배치하거나
                     각 탭별로 다른 뷰를 보여주도록 수정해야 함.
                     일단 기존 구조를 'panel-home' 안에 넣어서 호환성 유지 시도. -->

                <!-- Main Home Layout (Lobby) -->
                <div id="content-home" class="layout-dashboard tab-content active">
                    <!-- 1. 왼쪽: 보유 크리처 -->
                    <div id="left-panel" class="glass-panel">
                        <div class="panel-header">
                            <h3>보유 크리처</h3>
                            <div class="panel-controls"></div>
                        </div>
                        <div id="creature-controls">
                            <select id="sort-order" class="cyber-select">
                                <option value="rarity_desc">등급순 ▼</option>
                                <option value="level_desc">레벨순 ▼</option>
                                <option value="recent">최신순</option>
                            </select>
                            <select id="filter-rarity" class="cyber-select">
                                <option value="all">전체</option>
                                <option value="UR">UR</option>
                                <option value="SSR">SSR</option>
                                <option value="SR">SR</option>
                            </select>
                            <button id="btn-auto-compose" class="cyber-btn icon-only" title="자동 합성">⚡</button>
                        </div>
                        <div id="creature-list" class="scroll-custom"></div>
                    </div>

                    <!-- 2. 중앙: 상세/메인 -->
                    <div id="center-panel" class="glass-panel">
                        <div class="panel-header">
                            <h3>크리처 정보</h3>
                        </div>
                        <div id="detail-panel">
                            <p class="placeholder-text">크리처를 선택하세요</p>
                        </div>
                    </div>

                    <!-- 3. 오른쪽: 로그 -->
                    <div id="right-panel" class="glass-panel">
                        <div class="panel-header">
                            <h3>활동 로그</h3>
                        </div>
                        <div id="log-content" class="scroll-custom"
                            style="height:200px; font-size:0.8rem; color:#8b949e; padding:10px;"></div>
                    </div>

                    <!-- 4. 로비 캐릭터 -->
                    <div id="lobby-character-panel">
                        <div id="lobby-character-wrapper">
                            <img id="lobby-character-img" src="images/creature_god_zeus.png" alt="Lobby Character">
                            <div id="touch-head" class="touch-zone touch-head"></div>
                            <div id="touch-body" class="touch-zone touch-body"></div>
                            <div id="touch-legs" class="touch-zone touch-legs"></div>
                            <div id="lobby-speech-bubble" class="speech-bubble"><span id="lobby-speech-text">...</span>
                            </div>
                            <div id="lobby-buttons"
                                style="position:absolute; bottom:20px; right:20px; display:flex; flex-direction:column; gap:10px;">
                                <button class="cyber-btn small" id="btn-lobby-manage" style="opacity:0.8;">⚙️
                                    관리</button>
                                <button class="cyber-btn" id="btn-lobby-date"
                                    style="background: linear-gradient(135deg, #e91e63, #ad1457);">🥂 데이트</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- [Feature Views] -->

                <!-- 1. Summon View -->
                <div id="content-summon" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h3>차원 소환 (Dimension Summon)</h3>
                        </div>
                        <div style="display:flex; justify-content:center; gap:20px; margin-top:20px;">
                            <div class="summon-box normal">
                                <h4>일반 소환</h4>
                                <p>300 Gold / 1회</p>
                                <button id="btn-summon-n1" class="cyber-btn">1회 소환</button>
                                <button id="btn-summon-n10" class="cyber-btn">10회 소환</button>
                            </div>
                            <div class="summon-box premium">
                                <h4>프리미엄 소환</h4>
                                <p>1 Gem / 1회</p>
                                <button id="btn-summon-p1" class="cyber-btn premium">1회 소환</button>
                                <button id="btn-summon-p10" class="cyber-btn premium">10+1회 소환</button>
                            </div>
                        </div>
                        <div id="summon-result"
                            style="margin-top:20px; min-height:200px; display:flex; flex-wrap:wrap; justify-content:center; gap:10px;">
                        </div>
                    </div>
                </div>

                <!-- 2. Team View -->
                <div id="content-team" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h3>탐사대 관리 (Team Management)</h3>
                            <button id="btn-set-main-deck" class="cyber-btn small" style="margin-left:auto;">대표 덱
                                설정</button>
                        </div>
                        <div style="display:flex; gap:10px; margin-top:10px;">
                            <button class="deck-tab active" data-deck="main">Main Deck</button>
                            <button class="deck-tab" data-deck="sub1">Sub 1</button>
                            <button class="deck-tab" data-deck="defense">Defense</button>
                        </div>
                        <div id="label-active-deck" style="margin:10px 0; font-size:0.9em; color:#aaa;">현재: 대표 덱</div>

                        <div id="deck-slots" style="display:flex; gap:15px; justify-content:center; margin:20px 0;">
                            <!-- Slots injected by JS -->
                        </div>

                        <div class="panel-header">
                            <h3>보유 크리처 목록</h3>
                        </div>
                        <div id="deck-pool" class="scroll-custom"
                            style="display:grid; grid-template-columns:repeat(auto-fill, minmax(80px, 1fr)); gap:10px; height:300px; padding:10px;">
                            <!-- Pool injected by JS -->
                        </div>
                    </div>
                </div>

                <!-- 3. Shop View -->
                <div id="content-shop" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h3>보급 상점 (Supply Shop)</h3>
                        </div>
                        <div id="shop-list" class="scroll-custom"
                            style="display:grid; grid-template-columns:repeat(auto-fill, minmax(200px, 1fr)); gap:15px; padding:15px;">
                            <!-- Items injected by JS -->
                        </div>
                    </div>
                </div>

                <!-- Research & Mission Placeholders -->
                <div id="content-research" class="feature-view tab-content">
                    <div class="glass-panel">
                        <h3>연구소 (준비중)</h3>
                    </div>
                </div>
                <div id="content-mission" class="feature-view tab-content">
                    <div class="glass-panel">
                        <h3>미션 센터 (준비중)</h3>
                    </div>
                </div>

                <!-- 4. Battle View (Existing) -->
                <div id="content-battle" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h3 data-i18n="header.stage_operational">전술 작전 본부</h3>

                            <div style="display:flex; align-items:center; gap:10px;">
                                <!-- 배속 버튼 -->
                                <div
                                    style="display:flex; gap:2px; background:rgba(0,0,0,0.3); border-radius:4px; padding:2px;">
                                    <button id="btn-speed-1" class="cyber-btn small active"
                                        style="padding:4px 8px; font-size:0.8em; min-width:30px;">x1</button>
                                    <button id="btn-speed-2" class="cyber-btn small"
                                        style="padding:4px 8px; font-size:0.8em; min-width:30px;">x2</button>
                                </div>

                                <label class="toggle-container"
                                    style="display:flex; align-items:center; gap:8px; cursor:pointer; background:rgba(255,112,67,0.1); padding:5px 12px; border-radius:20px; border:1px solid var(--accent-orange);">
                                    <input type="checkbox" id="check-auto-battle" style="width:16px; height:16px;">
                                    <span style="font-size:0.85em; font-weight:bold; color:var(--accent-orange);">자동 연속
                                        전투</span>
                                </label>
                            </div>
                        </div>
                        <div class="panel-header">
                            <h2>전술 센터</h2>
                        </div>
                        <div style="padding: 20px;">
                            <!-- Stage Selector -->
                            <div id="stage-selector"
                                style="margin-bottom: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                                <h3 style="color:white; margin-top:0;" data-i18n="label.stage_select">작전 구역 선택
                                </h3>

                                <!-- Dynamic Stage Info (Restored for JS) -->
                                <div id="stage-title"
                                    style="color: var(--accent-cyan); font-size: 1.2em; font-weight: bold; margin-bottom: 5px;">
                                </div>
                                <div id="stage-info" style="margin-bottom: 5px; color: #ccc;"></div>
                                <div id="stage-rewards" style="margin-bottom: 15px; color: #f1c40f; font-size: 0.9em;">
                                </div>

                                <div style="display:flex; justify-content:space-between; align-items:center;">
                                    <button id="btn-prev-stage" class="cyber-btn small">&lt;</button>
                                    <button id="btn-next-stage" class="cyber-btn small">&gt;</button>
                                </div>
                            </div>

                            <button id="btn-start-stage" class="cyber-btn action" data-i18n="btn.battle_start"
                                style="width: 100%; padding: 20px; font-size: 1.2rem;">전투 개시 (START
                                OPERATION)</button>

                            <!-- PVP Section -->
                            <div style="margin-top:20px; border-top:1px dashed #444; padding-top:15px;">
                                <h3 style="color:#e74c3c;">PVP 대전</h3>

                                <!-- Friend Match -->
                                <div style="margin-bottom:15px;">
                                    <input type="text" id="pvp-friend-code" class="cyber-input" placeholder="대전 코드 입력"
                                        style="width:100%; box-sizing:border-box; margin-bottom:5px;">
                                    <button id="btn-pvp-start" class="cyber-btn danger" style="width: 100%;">대전
                                        매칭</button>
                                </div>

                                <!-- Lobby -->
                                <div style="background:rgba(0,0,0,0.2); padding:10px; border-radius:4px;">
                                    <div style="display:flex; gap:5px; margin-bottom:10px;">
                                        <input type="text" id="pvp-search-input" class="cyber-input"
                                            placeholder="유저 검색..." style="flex:1;">
                                        <button id="btn-pvp-search" class="cyber-btn small">🔍</button>
                                    </div>
                                    <div id="pvp-user-list"
                                        style="height:120px; overflow-y:auto; background:rgba(0,0,0,0.3); border:1px solid #333; padding:5px; font-size:0.8em;">
                                        <!-- Dynamic List -->
                                        <div style="text-align:center; padding-top:40px; color:#666;">검색 결과가 여기에 표시됩니다.
                                        </div>
                                    </div>

                                    <!-- My Code Info -->
                                    <div style="margin-top:10px;">
                                        <button id="btn-show-my-code" class="cyber-btn small" style="width:100%;">내 코드
                                            보기</button>
                                        <div id="my-code-area"
                                            style="display:none; margin-top:5px; padding:5px; background:#111; border:1px solid #333;">
                                            <div style="font-size:0.8em; color:#888; margin-bottom:3px;">아래 코드를 친구에게
                                                공유하세요</div>
                                            <div id="my-code-display"
                                                style="color:#2ecc71; font-family:monospace; font-weight:bold; word-break:break-all;">
                                                -</div>
                                            <button id="btn-get-my-code" class="cyber-btn small action"
                                                style="width:100%; margin-top:5px;">코드 생성</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. Team View (Preserved) -->
                <div id="content-team" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h2>탐사대 관리</h2>
                        </div>
                        <div
                            style="display:flex; gap:10px; margin-bottom:15px; border-bottom:1px solid #444; padding-bottom:10px;">
                            <button class="cyber-btn small deck-tab" data-deck="0">덱 1</button>
                            <button class="cyber-btn small deck-tab" data-deck="1">덱 2</button>
                            <button class="cyber-btn small deck-tab" data-deck="2">덱 3</button>
                        </div>
                        <div
                            style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <span id="label-active-deck" style="color:#aaa;">현재: 서브 덱</span>
                            <button id="btn-set-main-deck" class="cyber-btn small active-btn">대표 팀으로 설정</button>
                        </div>
                        <div style="display:flex; justify-content:space-around; padding:20px; background:rgba(0,0,0,0.2); margin-top:20px; border-radius:8px;"
                            id="deck-slots"></div>
                        <div style="text-align:center; margin-top:10px; color:#666; font-size:0.9em;"
                            data-i18n="label.pool_stats">슬롯을 클릭하여 출전 크리처를 변경하세요.</div>

                        <!-- [덱 풀] -->
                        <h4 style="margin-top:20px; border-bottom:1px solid #444; padding-bottom:5px;">보유 크리처</h4>
                        <div id="deck-pool"
                            style="display:grid; grid-template-columns:repeat(5, 1fr); gap:5px; margin-top:10px; max-height:300px; overflow-y:auto; padding:5px; background:rgba(0,0,0,0.2); border-radius:4px;">
                        </div>
                    </div>
                </div>

                <!-- 3.x Summon View -->
                <div id="content-summon" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h2>소환 제단 (SUMMONING ALTAR)</h2>
                        </div>
                        <div
                            style="padding:20px; text-align:center; display:flex; flex-direction:column; align-items:center; height:100%; justify-content:center;">
                            <!-- Result Area -->
                            <div id="summon-result"
                                style="flex:1; width:100%; display:flex; justify-content:center; align-items:center; flex-direction:column; min-height:200px;">
                                <div class="placeholder-text">차원의 틈새에서 크리처를 소환하세요.</div>
                            </div>

                            <!-- Buttons -->
                            <div
                                style="display:flex; justify-content:center; gap:20px; margin-top:20px; width:100%; flex-wrap:wrap;">
                                <div
                                    style="background:rgba(255,255,255,0.05); padding:20px; border-radius:12px; border:1px solid #444;">
                                    <h4 style="margin:0 0 15px 0; color:var(--text-primary); font-size:1.1em;">일반 소환
                                        (Gold)</h4>
                                    <div style="display:flex; gap:10px;">
                                        <button id="btn-summon-n1" class="cyber-btn" style="padding:10px 20px;">
                                            <div style="font-size:0.9em;">1회</div>
                                            <div style="font-size:0.8em; color:#f1c40f;">300 G</div>
                                        </button>
                                        <button id="btn-summon-n10" class="cyber-btn action" style="padding:10px 20px;">
                                            <div style="font-size:0.9em;">10+1회</div>
                                            <div style="font-size:0.8em; color:#f1c40f;">3,000 G</div>
                                        </button>
                                    </div>
                                </div>
                                <div
                                    style="background:rgba(171,71,188,0.1); padding:20px; border-radius:12px; border:1px solid var(--accent-purple);">
                                    <h4 style="margin:0 0 15px 0; color:var(--accent-purple); font-size:1.1em;">프리미엄 소환
                                        (Gem)</h4>
                                    <div style="display:flex; gap:10px;">
                                        <button id="btn-summon-p1" class="cyber-btn" style="padding:10px 20px;">
                                            <div style="font-size:0.9em;">1회</div>
                                            <div style="font-size:0.8em; color:var(--accent-cyan);">1 💎</div>
                                        </button>
                                        <button id="btn-summon-p10" class="cyber-btn action" style="padding:10px 20px;">
                                            <div style="font-size:0.9em;">10+1회</div>
                                            <div style="font-size:0.8em; color:var(--accent-cyan);">10 💎</div>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. Shop View (Preserved) -->
                <div id="content-shop" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h2>보급소</h2>
                        </div>
                        <div id="ad-banner-area"
                            style="margin:20px; padding:30px; border:1px dashed var(--border-accent); text-align:center; color:var(--accent-primary); cursor:pointer;">
                            [광고] 영상 시청 (+100 젬)
                        </div>
                        <div id="shop-list" class="shop-grid"></div>
                    </div>
                </div>

                <!-- 5. Mission View -->
                <div id="content-mission" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h2>미션 센터</h2>
                        </div>
                        <div style="padding: 10px;">
                            <h3 style="border-bottom: 1px solid #444; padding-bottom: 5px;">일일 미션</h3>
                            <div id="daily-quest-list" style="margin-bottom: 20px;"></div>

                            <h3 style="border-bottom: 1px solid #444; padding-bottom: 5px;">업적</h3>
                            <div id="achievement-list"></div>
                        </div>
                    </div>
                </div>

                <!-- 6. Expedition View (Restored) -->
                <div id="content-expedition" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h2 data-i18n="header.expedition">탐사 본부 (EXPEDITION)</h2>
                        </div>
                        <div style="margin-bottom: 20px;">
                            <h3 style="border-bottom: 1px solid #444; padding-bottom: 5px;"
                                data-i18n="header.active_expedition">진행 중인 탐사</h3>
                            <div id="active-expedition-list" style="min-height: 50px;"></div>
                        </div>
                        <div>
                            <h3 style="border-bottom: 1px solid #444; padding-bottom: 5px;"
                                data-i18n="header.expedition_zones">탐사 구역</h3>
                            <div class="expedition-controls"
                                style="margin-top:20px; display:flex; align-items:center; gap:15px; background:rgba(255,255,255,0.05); padding:10px; border-radius:8px;">
                                <label class="toggle-container"
                                    style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                                    <input type="checkbox" id="check-auto-repeat" style="width:18px; height:18px;">
                                    <span style="font-size:0.9em; font-weight:bold; color:var(--accent-cyan);">탐사 자동
                                        반복</span>
                                </label>
                                <div style="font-size:0.8em; opacity:0.6;">(완료 시 동일한 크리처로 재파견됩니다)</div>
                            </div>

                            <div id="expedition-list" class="grid-expedition" style="margin-top:20px;">
                                <!-- Expedition items will be injected here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 7. Research View (Restored) -->
                <div id="content-research" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h2>연구소</h2>
                        </div>
                        <div id="facility-list" style="padding:20px; overflow-y:auto;"></div>
                    </div>
                </div>

                <div id="content-prestige" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h2 style="color:var(--accent-purple);">차원 도약 (DIMENSION LEAP)</h2>
                        </div>
                        <div style="padding: 20px; text-align: center;">
                            <div
                                style="background: rgba(171,71,188,0.1); border: 1px solid var(--accent-purple); padding: 20px; border-radius: 12px; margin-bottom: 30px;">
                                <div style="font-size: 0.9em; color: var(--accent-purple); margin-bottom: 10px;">누적된 차원
                                    조각</div>
                                <div id="prestige-shards-total"
                                    style="font-size: 2.5em; font-weight: bold; font-family: 'Orbitron'; color: #fff; text-shadow: 0 0 10px var(--accent-purple);">
                                    0</div>
                                <div style="font-size: 0.8em; opacity: 0.7; margin-top: 5px;">현재 스테이지 기준 획득 예정: <span
                                        id="prestige-shards-pending" style="color:var(--accent-gold);">0</span></div>
                            </div>

                            <button id="btn-execute-prestige" class="cyber-btn"
                                style="width: 100%; padding: 20px; font-size: 1.2rem; background: linear-gradient(135deg, #6a1b9a, #ab47bc); border: none; box-shadow: 0 0 20px rgba(171,71,188,0.4); margin-bottom: 40px;">
                                🌀 차원 도약 실행 (전체 초기화)
                            </button>

                            <h3
                                style="text-align: left; border-bottom: 1px solid #444; padding-bottom: 10px; margin-bottom: 20px;">
                                영구 영혼 강화</h3>
                            <div class="prestige-upgrades-grid"
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <button class="prestige-upgrade-btn" data-type="attack_multi"
                                    style="background: rgba(255,255,255,0.05); border: 1px solid #444; padding: 15px; border-radius: 8px; color: #fff; cursor: pointer;">
                                    <div style="font-size: 0.8em; opacity: 0.6;">공격력 강화</div>
                                    <div class="lv" style="font-weight: bold; color: var(--accent-primary);">Lv.<span
                                            class="val">0</span></div>
                                    <div style="font-size: 0.7em; margin-top: 5px; color: var(--accent-gold);">비용: <span
                                            class="cost">10</span></div>
                                </button>
                                <button class="prestige-upgrade-btn" data-type="gold_multi"
                                    style="background: rgba(255,255,255,0.05); border: 1px solid #444; padding: 15px; border-radius: 8px; color: #fff; cursor: pointer;">
                                    <div style="font-size: 0.8em; opacity: 0.6;">골드 획득</div>
                                    <div class="lv" style="font-weight: bold; color: var(--accent-cyan);">Lv.<span
                                            class="val">0</span></div>
                                    <div style="font-size: 0.7em; margin-top: 5px; color: var(--accent-gold);">비용: <span
                                            class="cost">10</span></div>
                                </button>
                                <button class="prestige-upgrade-btn" data-type="exp_multi"
                                    style="background: rgba(255,255,255,0.05); border: 1px solid #444; padding: 15px; border-radius: 8px; color: #fff; cursor: pointer;">
                                    <div style="font-size: 0.8em; opacity: 0.6;">성장 속도</div>
                                    <div class="lv" style="font-weight: bold; color: var(--accent-magenta);">Lv.<span
                                            class="val">0</span></div>
                                    <div style="font-size: 0.7em; margin-top: 5px; color: var(--accent-gold);">비용: <span
                                            class="cost">10</span></div>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 8. Shop View (Restored) -->
                <div id="content-shop" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h2>보급소</h2>
                        </div>
                        <div style="flex:1; overflow-y:auto; padding:15px;">
                            <div id="ad-banner"
                                style="height:80px; background:linear-gradient(45deg, #ff00cc, #333399); margin-bottom:20px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:bold; color:white; text-shadow:0 0 5px rgba(0,0,0,0.5);">
                                ✨ 특별 프로모션 패키지 판매 중!
                            </div>
                            <div id="shop-list"
                                style="display:grid; grid-template-columns:repeat(auto-fill, minmax(140px, 1fr)); gap:15px;">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 9. Battle View (Restored) -->
                <div id="content-battle" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h2>전투 시뮬레이션</h2>
                        </div>
                        <div style="padding:20px; text-align:center; overflow-y: auto;">
                            <h3 id="stage-title" style="font-size:1.5rem; margin-bottom:10px;">Stage 1</h3>
                            <div id="stage-info" style="margin-bottom:15px; color:#aaa;"></div>
                            <div id="stage-rewards" style="margin-bottom:20px; color:#ddd;"></div>

                            <div style="display:flex; justify-content:center; gap:20px; margin-bottom:30px;">
                                <button id="btn-prev-stage" class="cyber-btn small">&lt; 이전</button>
                                <button id="btn-start-stage" class="cyber-btn action"
                                    style="padding:15px 40px; font-size:1.2rem;">⚔️ 전투 시작</button>
                                <button id="btn-next-stage" class="cyber-btn small">다음 &gt;</button>
                            </div>

                            <div style="margin-bottom:20px;">
                                <label style="cursor:pointer; user-select:none;"><input type="checkbox"
                                        id="check-auto-battle"> 자동 전투 반복</label>
                            </div>

                            <hr style="border:0; border-top:1px solid #444; margin:30px 0;">

                            <h4>PvP 아레나</h4>
                            <div style="display:flex; gap:10px; margin-bottom:15px; margin-top:10px;">
                                <input type="text" id="pvp-search-input" placeholder="상대 검색..." class="cyber-input"
                                    style="flex:1;">
                                <button id="btn-pvp-search" class="cyber-btn">검색</button>
                            </div>
                            <div id="pvp-user-list"></div>
                        </div>
                    </div>
                </div>

                <!-- 10. Team View (Restored) -->
                <div id="content-team" class="feature-view tab-content">
                    <div class="glass-panel full-height">
                        <div class="panel-header">
                            <h2>탐사대 편성</h2>
                            <div id="label-active-deck" style="font-size:0.9em; margin-left:15px;"></div>
                        </div>
                        <div style="padding:15px; flex:1; overflow-y:auto;">
                            <!-- Deck Tabs -->
                            <div style="display:flex; gap:10px; margin-bottom:15px;">
                                <button class="deck-tab active" data-deck="main"
                                    style="padding:5px 15px; background:rgba(255,255,255,0.1); border-radius:4px; border:none; color:white; cursor:pointer;">MAIN</button>
                                <button class="deck-tab" data-deck="sub1"
                                    style="padding:5px 15px; background:rgba(255,255,255,0.1); border-radius:4px; border:none; color:white; cursor:pointer;">SUB
                                    1</button>
                            </div>
                            <!-- Slots -->
                            <div id="deck-slots"
                                style="display:flex; gap:10px; justify-content:center; margin-bottom:20px; flex-wrap:wrap;">
                            </div>
                            <button id="btn-set-main-deck" class="cyber-btn"
                                style="width:100%; display:none; margin-bottom:20px;">이 덱을 대표 덱으로 설정</button>

                            <h4 style="margin:20px 0 10px;">보유 크리처</h4>
                            <p style="color:#666; font-size:0.9em;">(홈 화면의 목록과 연동됩니다)</p>
                            <!-- Note: Creature List is in Home Tab, logic needs revisit via UIManager moving it or cloning -->
                        </div>
                    </div>
                </div>
            </div> <!-- End of content-viewport -->
        </main>

        <!-- 3. Bottom Dock (Navigation) -->
        <nav id="bottom-dock" class="glass-panel">
            <button id="tab-home" class="nav-item active">
                <span class="icon">🏠</span> <span>메인</span>
            </button>
            <button id="tab-summon" class="nav-item">
                <span class="icon">🔮</span> <span>소환</span>
            </button>
            <button id="tab-team" class="nav-item">
                <span class="icon">👥</span> <span>팀</span>
            </button>
            <button id="tab-battle" class="nav-item">
                <span class="icon">⚔️</span> <span>작전</span>
            </button>
            <button id="tab-expedition" class="nav-item">
                <span class="icon">🚀</span> <span>탐사</span>
            </button>
            <button id="tab-research" class="nav-item">
                <span class="icon">🧪</span> <span>연구</span>
            </button>
            <button id="tab-mission" class="nav-item">
                <span class="icon">📝</span> <span>미션</span>
            </button>
            <button id="tab-shop" class="nav-item">
                <span class="icon">🛒</span> <span>상점</span>
            </button>
            <button id="btn-logout" class="nav-item" title="로그아웃" style="color:var(--accent-danger);">
                <span class="icon">🚪</span> <span>나가기</span>
            </button>
        </nav>
    </div> <!-- End of App Container -->

    <!-- =========================================
         GLOBAL OVERLAYS (Outside App Container)
         ========================================= -->

    <!-- Debug Cheat Button -->
    <div id="dev-controls" style="position: fixed; bottom: 10px; right: 10px; z-index: 9999; display: none;">
        <button id="devFillResources" style="padding: 10px; background: red; color: white;">[DEV] 자원 채우기</button>
    </div>

    <!-- Tutorial Overlay -->
    <div id="tutorial-overlay" style="display: none;">
        <div id="tutorial-msg-box">
            <p id="tutorial-text">튜토리얼 안내 문구</p>
            <button id="btn-skip-tutorial">튜토리얼 건너뛰기</button>
        </div>
    </div>

    <!-- Custom Confirmation Modal -->
    <div id="custom-modal-overlay"
        style="display: none; z-index: 20000; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); justify-content: center; align-items: center;">
        <div id="custom-modal-box">
            <p id="custom-modal-msg">알림</p>
            <div id="custom-modal-buttons" style="margin-top: 20px; display: flex; justify-content: center; gap: 10px;">
                <button id="btn-modal-yes"
                    style="background:#2ecc71; color:white; border:none; padding:8px 20px; border-radius:4px; cursor:pointer;">확인</button>
                <button id="btn-modal-no"
                    style="background:#e74c3c; color:white; border:none; padding:8px 20px; border-radius:4px; cursor:pointer;">취소</button>
            </div>
        </div>
    </div>

    <!-- Creature Detail Modal -->
    <div id="creature-detail-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content glass-panel detail-modal-content">
            <div id="modal-detail-body">
                <!-- Content injected by CreatureView.js -->
            </div>
        </div>
    </div>

    <!-- Expedition Selective Modal -->
    <div id="expedition-select-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content glass-panel">
            <div class="detail-header"
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0;">탐사대 편성</h3>
                <button id="btn-close-exp-modal" class="cyber-btn small" style="font-size:1.5rem;">×</button>
            </div>
            <p style="color:var(--text-secondary); margin-bottom:15px; font-size:0.9rem;">탐사를 보낼 크리처를 선택하세요.</p>
            <div id="exp-creature-list"
                style="display:grid; grid-template-columns:repeat(auto-fill, minmax(80px, 1fr)); gap:10px; max-height:400px; overflow-y:auto; padding:10px; background:rgba(0,0,0,0.2); border-radius:8px;">
                <!-- Creatures injected by ExpeditionView.js -->
            </div>
        </div>
    </div>

    <!-- Battle Overlay -->
    <div id="battle-overlay">
        <div id="battle-header">
            <div>TURN 1</div>
            <div>BATTLE IN PROGRESS</div>
        </div>
        <div id="battle-stage">
            <!-- Entities injected by JS -->
        </div>
        <div id="battle-controls">
            <!-- Battle Controls restored -->
            <button class="cyber-btn" id="btn-lobby-manage">관리</button>
            <button class="cyber-btn" id="btn-lobby-date"
                style="background: linear-gradient(135deg, #e91e63, #ad1457); box-shadow: 0 0 10px #e91e63;">🥂
                데이트</button>
            <button disabled>Auto Battle On</button>
        </div>
    </div>

    <!-- Auth / Login Overlay -->
    <div id="login-overlay"
        style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999999; justify-content: center; align-items: center; flex-direction: column;">

        <!-- Logo Area -->
        <h1
            style="font-family: 'Orbitron', sans-serif; color: #58a6ff; font-size: 2.5rem; margin-bottom: 20px; text-shadow: 0 0 20px rgba(88, 166, 255, 0.6); text-align:center;">
            MULTIVERSE<br><span style="font-size:0.6em; letter-spacing:5px; color:#fff;">CREATURE LAB</span>
        </h1>

        <!-- Auth Card -->
        <div id="auth-card" class="glass-panel"
            style="width: 90%; max-width: 400px; padding: 0; overflow: hidden; border: 1px solid var(--border-tech); box-shadow: 0 0 50px rgba(0,0,0,0.8);">

            <!-- Tabs -->
            <div style="display:flex; border-bottom:1px solid var(--border-tech);">
                <button id="tab-login-mode" class="auth-tab active" data-i18n="auth.login"
                    style="flex:1; padding:15px; background:transparent; border:none; color:white; font-family:'Orbitron'; cursor:pointer; font-size:1.1rem;">로그인</button>
                <button id="tab-signup-mode" class="auth-tab" data-i18n="auth.signup"
                    style="flex:1; padding:15px; background:rgba(255,255,255,0.05); border:none; color:#888; font-family:'Orbitron'; cursor:pointer; font-size:1.1rem;">회원가입</button>
            </div>

            <!-- Form Body -->
            <div style="padding: 30px;">
                <!-- Persona Selection Area -->
                <div style="display:flex; gap:20px; margin-bottom:20px; align-items: flex-start;">
                    <!-- Avatar Column -->
                    <div style="flex:1; text-align:center;">
                        <div id="selected-avatar-preview"
                            style="width:100px; height:100px; border-radius:12px; border:2px solid var(--accent-cyan); margin:0 auto 10px; overflow:hidden; background:#000; box-shadow: 0 0 15px var(--accent-cyan);">
                            <img id="avatar-preview-img" src="images/creature_valkyrie.png"
                                style="width:100%; height:100%; object-fit:cover;">
                        </div>
                        <div id="avatar-options" style="display:flex; justify-content:center; gap:5px; flex-wrap:wrap;">
                            <img src="images/creature_valkyrie.png" class="avatar-option selected"
                                data-id="director_vesper" title="Dr. Vesper"
                                style="width:40px; height:40px; border-radius:50%; border:2px solid transparent; cursor:pointer;">
                            <img src="images/creature_god_zeus.png" class="avatar-option" data-id="director_kael"
                                title="Commander Kael"
                                style="width:40px; height:40px; border-radius:50%; border:2px solid transparent; cursor:pointer;">
                            <img src="images/creature_void_emperor.png" class="avatar-option" data-id="director_zero"
                                title="Subject Zero"
                                style="width:40px; height:40px; border-radius:50%; border:2px solid transparent; cursor:pointer;">
                            <img src="images/creature_creator_gaia.png" class="avatar-option" data-id="director_eos"
                                title="Lady Eos"
                                style="width:40px; height:40px; border-radius:50%; border:2px solid transparent; cursor:pointer;">
                        </div>
                    </div>

                    <!-- Bio Column -->
                    <div style="flex:1.5; text-align:left; border-left:1px solid #333; padding-left:15px;">
                        <h3 id="persona-name" style="color:white; margin:0; font-family:'Orbitron';">Dr. Vesper
                        </h3>
                        <div id="persona-title"
                            style="color:var(--accent-magenta); font-size:0.8rem; margin-bottom:10px;"></div>
                        <div id="persona-bio" style="font-size:0.85rem; color:#aaa; line-height:1.4;"></div>
                    </div>
                </div>

                <!-- Input Fields -->
                <div style="display:flex; flex-direction:column; gap:15px;">
                    <input type="text" id="auth-username" data-i18n="auth.id_placeholder" placeholder="접속 ID (Username)"
                        class="cyber-input" style="padding:12px; border-radius:4px; font-size:1rem;">

                    <input type="password" id="auth-password" data-i18n="auth.pw_placeholder"
                        placeholder="비밀번호 (Passphrase)" class="cyber-input"
                        style="padding:12px; border-radius:4px; font-size:1rem;">

                    <input type="password" id="auth-confirm-password" data-i18n="auth.confirm_placeholder"
                        placeholder="비밀번호 확인 (Confirm)" class="cyber-input"
                        style="padding:12px; border-radius:4px; font-size:1rem; display:none;">
                </div>

                <!-- Login Options -->
                <div
                    style="display:flex; justify-content:space-between; margin-top:10px; font-size:0.85rem; color:#ccc;">
                    <label style="display:flex; align-items:center; gap:5px; cursor:pointer;">
                        <input type="checkbox" id="check-remember-me" style="accent-color:var(--accent-cyan);"> 아이디 저장
                    </label>
                    <label style="display:flex; align-items:center; gap:5px; cursor:pointer;">
                        <input type="checkbox" id="check-auto-login" checked style="accent-color:var(--accent-cyan);">
                        자동 로그인
                    </label>
                </div>

                <!-- Action Button -->
                <button id="btn-auth-action" class="cyber-btn action" data-i18n="auth.btn_login"
                    style="width:100%; padding:15px; margin-top:25px; font-size:1.1rem; border-radius:4px;">접속
                    개시 (LOGIN)</button>

                <div id="auth-message"
                    style="margin-top:15px; text-align:center; color:#e74c3c; font-size:0.9rem; min-height:20px;">
                </div>
            </div>
        </div>
    </div> <!-- End of login-overlay -->

    <!-- System Modal (MUST be outside login-overlay) -->
    <div id="system-modal-overlay"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000000000; justify-content: center; align-items: center;">
        <div class="glass-panel"
            style="width: 90%; max-width: 600px; height: 70%; display: flex; flex-direction: column; padding: 0;">
            <!-- Header -->
            <div
                style="padding: 15px; border-bottom: 1px solid var(--border-tech); display: flex; justify-content: space-between; align-items: center;">
                <h2 style="margin: 0; color: var(--accent-cyan); font-family: 'Orbitron';">시스템 설정 (SYSTEM)</h2>
                <button id="btn-close-system"
                    style="background: none; border: none; color: #888; font-size: 1.5rem; cursor: pointer;">&times;</button>
            </div>

            <!-- Tabs -->
            <div style="display: flex; background: rgba(0,0,0,0.3);">
                <button class="system-tab active" data-tab="notice"
                    style="flex: 1; padding: 15px; background: transparent; border: none; color: white; cursor: pointer; border-bottom: 2px solid var(--accent-cyan);">공지사항</button>
                <button class="system-tab" data-tab="coupon"
                    style="flex: 1; padding: 15px; background: transparent; border: none; color: #888; cursor: pointer; border-bottom: 2px solid transparent;">🎁
                    쿠폰</button>
                <button class="system-tab" data-tab="contact"
                    style="flex: 1; padding: 15px; background: transparent; border: none; color: #888; cursor: pointer; border-bottom: 2px solid transparent;">1:1
                    문의</button>
            </div>

            <!-- Content -->
            <div style="flex: 1; overflow-y: auto; padding: 20px;">

                <!-- Notice View -->
                <div id="view-notice">
                    <div class="notice-item"
                        style="border-bottom: 1px dashed #444; padding-bottom: 15px; margin-bottom: 15px;">
                        <h3 style="color: #f1c40f; margin-bottom: 5px;">[업데이트] v2.1.0 알파 릴리즈</h3>
                        <div style="font-size: 0.8rem; color: #888; margin-bottom: 10px;">2025-12-12</div>
                        <p style="font-size: 0.9rem; line-height: 1.4;">
                            - UI 전면 개편: 테크-느와르 스타일 적용<br>
                            - 신규 기능: 지휘관(Director) 페르소나 시스템<br>
                            - 모바일 최적화 완료
                        </p>
                    </div>
                </div>

                <!-- Coupon View -->
                <div id="view-coupon" style="display: none;">
                    <p style="color: #8b949e; margin-bottom: 20px;">보상 코드를 입력하여 특별 보상을 받으세요!</p>
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <input type="text" id="coupon-code-input" placeholder="코드 입력" style="flex:1; padding:12px 15px; background:rgba(0,0,0,0.4); border:1px solid var(--accent-primary); 
                                   border-radius:8px; color:#fff; font-size:1rem; text-transform:uppercase;">
                        <button id="btn-redeem-coupon" class="cyber-btn" style="padding:12px 25px;">
                            🎁 사용
                        </button>
                    </div>
                    <div id="coupon-result" style="padding:15px; border-radius:8px; display:none;"></div>
                    <div style="margin-top:20px; padding:15px; background:rgba(255,255,255,0.05); border-radius:8px;">
                        <h4 style="color:var(--accent-gold); margin-bottom:10px;">📋 사용 가능한 코드</h4>
                        <ul style="color:#aaa; font-size:0.9rem; line-height:1.8;">
                            <li><code style="background:#333; padding:2px 8px; border-radius:4px;">YESOL2025</code>
                                - UR/SSR/SR 크리처 20마리 지급</li>
                            <li><code style="background:#333; padding:2px 8px; border-radius:4px;">GOLDRICH</code> -
                                골드 100,000 지급</li>
                            <li><code style="background:#333; padding:2px 8px; border-radius:4px;">GEMMASTER</code>
                                - 젬 500 지급</li>
                        </ul>
                    </div>
                </div>

                <!-- Contact View -->
                <div id="view-contact" style="display: none;">
                    <p style="color: #8b949e; margin-bottom: 20px;">버그 제보나 건의사항을 보내주세요. 24시간 내에 답변해 드립니다.</p>
                </div>

            </div>
        </div>
    </div>

    <!-- 크리처 상세 정보 모달 -->
    <div id="creature-detail-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content glass-panel" style="max-width:450px; width:90%;">
            <button id="btn-close-detail" class="modal-close-btn">✕</button>
            <div id="modal-detail-body">
                <!-- 동적으로 내용 채워짐 -->
            </div>
        </div>
    </div>

    <!-- Date Course Modal -->
    <div id="date-select-modal" class="modal-overlay" style="display:none;">
        <div class="modal-content glass-panel" style="max-width:400px; text-align:center;">
            <div class="detail-header" style="margin-bottom:20px;">
                <h3>🥂 데이트 코스 선택</h3>
                <button onclick="document.getElementById('date-select-modal').style.display='none'"
                    class="cyber-btn small">×</button>
            </div>
            <div id="date-course-list" style="display:flex; flex-direction:column; gap:10px;">
                <!-- Injected by JS -->
            </div>
        </div>
    </div>

    <script src="js/debug_overlay.js"></script>
    <script type="module" src="js/main.js?v=resonance_v3_date"></script>
</body>

</html>